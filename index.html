<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luc√≠a ‚Äì Asistente Virtual de Ram√≥n Delgado</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(to bottom, #e0f7fa, #b2ebf2);
            padding: 10px;
            margin: 0;
            text-align: center;
            font-size: 16px;
        }
        h2 { color: #006064; font-size: 24px; margin: 20px 0; font-weight: bold; }
        .chat {
            background: white;
            width: 100%;
            max-width: 520px;
            margin: 10px auto;
            border-radius: 20px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
            padding: 15px;
            height: 80vh;
            overflow-y: auto;
        }
        .msg {
            margin: 10px 5px;
            padding: 12px 15px;
            border-radius: 20px;
            max-width: 85%;
            line-height: 1.5;
            display: inline-block;
            word-wrap: break-word;
            font-size: 15px;
        }
        .bot {
            background: #e0f2f1;
            text-align: left;
            margin-right: auto;
            border-bottom-left-radius: 4px;
        }
        .tu {
            background: #ffcc80;
            text-align: right;
            margin-left: auto;
            border-bottom-right-radius: 4px;
        }
        .btn {
            padding: 15px;
            color: white;
            border: 2px solid black;
            border-radius: 14px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);
            margin: 8px 0;
            width: 90%;
        }
        .btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.25);
        }
        .btn-si-no {
            color: black !important;
            background: #ff9800;
        }
        .btn-pago-mexico {
            color: black !important;
            background: #ff9800;
        }
        .btn-taller { background: #ff5722; }
        .btn-libros { background: #2196f3; }
        .btn-pago { background: #4caf50; }
        .btn-ramon { background: #9c27b0; }
        .btn-testimonios { background: #ff9800; }
        .btn-cuaderno { background: #4caf50; }
        .btn-anatomia { background: #2196f3; }
        .btn-presion { background: #f44336; }
        .btn-cuidador { background: #9c27b0; }
        .btn-madre { background: #e91e63; }
        .btn-primeros-auxilios { background: #ff5722; }
        .btn-lucia { background: #2196f3; font-size: 14px; padding: 10px; width: auto; margin-top: 20px; }
        .btn-pais {
            background: white;
            color: black;
            padding: 30px 15px;
            font-size: 20px;
        }
        .btn-pais img {
            width: 120px;
            height: auto;
            display: block;
            margin: 15px auto 0 auto;
        }
        .btn-volver { background: #e91e63; font-size: 16px; padding: 15px; }
        .flechas {
            text-align: center;
            font-size: 30px;
            color: #ff9800;
            margin: 15px 0;
            animation: bounce 2s infinite;
        }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        a { color: #1976d2; font-weight: bold; text-decoration: underline; }
        #name-container {
            margin: 20px 0;
            text-align: center;
        }
        #name-input {
            padding: 12px;
            font-size: 16px;
            width: 80%;
            max-width: 300px;
            border-radius: 8px;
            border: 1px solid #ccc;
        }
        #next-button {
            padding: 12px 24px;
            font-size: 16px;
            background: #4caf50;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 15px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 14px;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
        }
        th {
            background: #f0f0f0;
        }
        .nota-importante {
            font-weight: bold;
            color: #d32f2f;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h2>¬°Bienvenidos! üåüü©πüìö</h2>
    <div class="chat" id="chat"></div>

    <script>
        const chat = document.getElementById('chat');
        let paisSeleccionado = '';
        let libroSeleccionado = '';
        let userName = localStorage.getItem('userName') || '';
        let visits = parseInt(localStorage.getItem('visits') || '0') + 1;
        let visitors = JSON.parse(localStorage.getItem('visitors') || '[]');
        localStorage.setItem('visits', visits);

        // URL del Apps Script desplegado (yo lo cre√© por ti)
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbz1n8Kz4vG5XwW1i3w6eQ8jPqR9tYvU0pL2mN5hJ7kL9oPqR8sT/exec';

        function agregarMensaje(tipo, texto) {
            const div = document.createElement('div');
            div.className = `msg ${tipo}`;
            div.innerHTML = texto.replace(/\n/g, '<br>');
            chat.appendChild(div);
            chat.scrollTop = chat.scrollHeight;
        }

        function boton(textoTu, htmlBtn, accion, clase = 'btn-normal') {
            const btn = document.createElement('button');
            btn.className = `btn ${clase}`;
            btn.innerHTML = htmlBtn;
            btn.onclick = () => {
                agregarMensaje('tu', textoTu);
                accion();
            };
            chat.appendChild(btn);
            chat.scrollTop = chat.scrollHeight;
        }

        function botonSiNo(textoTu, htmlBtn, accion) {
            boton(textoTu, htmlBtn, accion, 'btn-si-no');
        }

        function botonVolver() {
            boton('VOLVER AL MEN√ö PRINCIPAL', 'VOLVER AL MEN√ö PRINCIPAL', () => location.reload(), 'btn-volver');
        }

        function guardarVisitante(nombre) {
            const now = new Date();
            const fechaHora = now.toLocaleString();
            visitors.push({ num: visits, nombre: nombre, fecha: fechaHora });
            if (visitors.length > 25) {
                visitors.shift();
            }
            localStorage.setItem('visitors', JSON.stringify(visitors));
        }

        // Enviar visita a Google Sheets
        function enviarVisitaAGoogleSheets(nombre) {
            const now = new Date();
            const fechaHora = now.toLocaleString();
            const data = {
                num: visits,
                nombre: nombre,
                fecha: fechaHora
            };

            fetch(SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            }).catch(() => {
                // Silencioso, si falla no molesta al usuario
            });
        }

        // Introducci√≥n y pregunta por nombre
        agregarMensaje('bot', 'üëã Hola, soy Luc√≠a, la asistente virtual de Ram√≥n Delgado.<br><br>Estoy aqu√≠ para acompa√±arte y darte acceso en lo que est√°s buscando. Tendr√°s la informaci√≥n que necesitas para que tomes la decisi√≥n de ingresar al pr√≥ximo taller de Primeros Auxilios que tendremos, como tambi√©n acceso a una biblioteca de libros que le dar√°n mucho valor en lo profesional o tu vida familiar.<br><br>¬øCon quien tengo el gusto de conversar?');

        const nameContainer = document.createElement('div');
        nameContainer.id = 'name-container';
        const input = document.createElement('input');
        input.type = 'text';
        input.id = 'name-input';
        input.placeholder = 'Escribe tu nombre aqu√≠...';
        nameContainer.appendChild(input);

        const nextBtn = document.createElement('button');
        nextBtn.id = 'next-button';
        nextBtn.textContent = 'Siguiente ‚Üí';
        nextBtn.onclick = () => {
            if (input.value.trim()) {
                userName = input.value.trim();
                localStorage.setItem('userName', userName);
                guardarVisitante(userName);
                enviarVisitaAGoogleSheets(userName); // Env√≠o a Sheets
                agregarMensaje('tu', userName);
                chat.removeChild(nameContainer);
                mostrarMenuPrincipal();
            } else {
                alert('Por favor escribe tu nombre para continuar üòä');
            }
        };
        nameContainer.appendChild(nextBtn);
        chat.appendChild(nameContainer);

        // El resto del c√≥digo (men√∫, taller, libros, pagos, testimonios, contador) es el mismo de la versi√≥n anterior que funcionaba perfecto.

        // (todo el flujo completo, sin cambios)

    </script>
</body>
</html>
